(window.webpackJsonp = window.webpackJsonp || []).push([['chunk-419d9f22'], { '085d' (t, e, n) { 'use strict'; n.r(e); const i = function () { const t = this; const e = t.$createElement; const n = t._self._c || e; return n('div', { staticClass: 'interface-many-to-one' }, [!1 === t.relationSetup ? n('div', { staticClass: 'notice' }, [n('p', [n('v-icon', { attrs: { name: 'warning' } }), t._v(' ' + t._s(t.$t('interfaces.many-to-many.relation_not_setup')) + ' ')], 1)]) : [n('v-select', { class: { 'select-loading': t.loading }, attrs: { id: t.name, name: t.name, placeholder: t.options.placeholder || '', options: t.selectOptions, disabled: t.readonly, value: t.valuePK, icon: t.options.icon }, on: { input (e) { return t.$emit('input', e) } } }), !t.readonly && t.count > t.options.threshold ? n('button', { attrs: { type: 'button' }, on: { click (e) { t.listingActive = !0 } } }) : t._e(), n('v-spinner', { directives: [{ name: 'show', rawName: 'v-show', value: t.loading, expression: 'loading' }], staticClass: 'spinner', attrs: { color: '--blue-grey-300', 'background-color': '--blue-grey-200' } }), t.listingActive ? n('v-item-select', { attrs: { collection: t.relation.collection_one.collection, fields: t.relatedFields, filters: [], single: '', value: t.stagedValue || t.valuePK }, on: { input: t.stageValue, done: t.closeListing, cancel: t.cancelListing } }) : t._e()]], 2) }; const l = []; const a = (n('99af'), n('d81d'), n('d3b7'), n('ac1f'), n('3ca3'), n('1276'), n('498a'), n('ddb0'), n('2909')); const o = n('3835'); const s = n('8db2'); const r = n.n(s); const c = n('1581'); const u = n('2ef0'); const d = { name: 'InterfaceManyToOne', mixins: [r.a], data () { return { loading: !1, error: null, items: [], count: null, listingActive: !1, selectionSaving: !1, newSelected: null, stagedValue: null } }, computed: { relationSetup () { return !!this.relation }, relatedPrimaryKeyField () { return Object(u.find)(this.relation.collection_one.fields, { primary_key: !0 }).field }, valuePK () { return Object(u.isObject)(this.value) ? this.value[this.relatedPrimaryKeyField] : this.value }, relatedFields () { const t = this.options.visible_fields; return t && t.length !== 0 ? t.split(',').map(function (t) { return t.trim() }) : Object(c.a)(this.options.template) }, selectOptions () { if (this.items.length === 0) { return {} } const t = this.$helpers.micromustache.compile(this.options.template); return Object(u.mapValues)(Object(u.keyBy)(this.items, this.relatedPrimaryKeyField), function (e) { return t(e) }) } }, watch: { relation () { this.relationSetup && this.fetchItems() } }, created () { this.relationSetup && this.fetchItems() }, methods: { stageValue (t) { this.stagedValue = t }, fetchItems () { const t = this; if (this.relation != null) { const e = this.relation.collection_one.collection; this.loading = !0; const n = { fields: '*.*', meta: 'total_count', limit: this.options.threshold }; return Promise.all([this.$api.getItems(e, n), this.value ? this.$api.getItem(e, this.valuePK) : null]).then(function (e) { const n = Object(o.a)(e, 2); const i = n[0]; const l = i.meta; const s = i.data; const r = n[1]; t.items = r ? [].concat(Object(a.a)(s), [r.data]) : s, t.loading = !1, t.count = l.total_count }).catch(function (e) { console.error(e), t.error = e, t.loading = !1 }) } }, closeListing () { const t = this; this.$emit('input', this.stagedValue); const e = this.relation.collection_one.collection; const n = { fields: '*.*', limit: 1 }; this.loading = !0, this.$api.getItem(e, this.stagedValue, n).then(function (t) { return t.data }).then(function (e) { return t.items = [].concat(Object(a.a)(t.items), [e]) }).catch(function (e) { console.error(e), t.error = e, t.loading = !1 }).finally(function () { return t.loading = !1 }), this.stagedValue = null, this.listingActive = !1 }, cancelListing () { this.stagedValue = null, this.listingActive = !1 } } }; const f = d; const h = (n('853a'), n('2877')); const p = Object(h.a)(f, i, l, !1, null, '211f47d1', null); e.default = p.exports }, '74bd' (t, e, n) {}, '853a' (t, e, n) { 'use strict'; const i = n('74bd'); const l = n.n(i); l.a }, '8db2' (t, e) { t.exports = { props: { id: { type: String, required: !0 }, name: { type: String, required: !0 }, value: { type: null, default: null }, type: { type: String, required: !0 }, length: { type: [String, Number], default: null }, readonly: { type: Boolean, default: !1 }, collection: { type: String, default: null }, primaryKey: { type: [Number, String], default: null }, required: { type: Boolean, default: !1 }, options: { type: Object, default: () => ({}) }, newItem: { type: Boolean, default: !1 }, relation: { type: Object, default: null }, fields: { type: Object, default: null }, values: { type: Object, default: null }, width: { type: String, default: null, validator (t) { return ['half', 'half-left', 'half-right', 'full', 'fill'].includes(t) } } } } } }])
// # sourceMappingURL=chunk-419d9f22.1066a846.js.map
